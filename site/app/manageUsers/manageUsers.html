<h2 class="mainheader">Manage Users
    <hr>
</h2>

<alert ng-repeat="alert in alerts" type="{{alert.type}}" close="alerts.splice($index, 1);"><div ng-bind-html="alert.msg | sanitize"></div></alert>
<div ng-show="!localLoading" style="display:block;width:100px;margin:50px auto">
    <img src="/images/squares.gif" style="width:100px">
</div>
<div ng-show="localLoading">

    <div class="btn-group action_dropdown pull-left">
        <button type="button" class="btn btn-default dropdown-toggle btn-sm" uib-tooltip="Add User" ng-click="edit()">
            <span class="fa fa-plus"></span> Add User
        </button>
    </div>

    <div class="btn-group action_dropdown pull-right">
        <button type="button" class="btn btn-default dropdown-toggle btn-sm" uib-tooltip="Download Results" ng-click="download()">
            <span class="fa fa-download"></span>
        </button>
    </div>

    <div class="btn-group action_dropdown stay_open_button pull-right" style="margin-right:5px">
        <button type="button" class="btn btn-default dropdown-toggle btn-sm" data-toggle="dropdown" aria-expanded="false" uib-tooltip="Filters">
            <span class="fa fa-filter"></span> <span class="caret"></span>
        </button>
        <div class="dropdown-menu dropdown-menu-right" role="menu" style="padding-left:10px" onclick="event.stopPropagation();">
            <table>
                <tr>
                    <td class="center">
                        <input type="checkbox" ng-model="showActive" ng-click="calcActive()" id="showActive">
                    </td>
                    <Td>
                        &nbsp;<label for="showActive" style="font-weight: normal">Active</label>
                    </Td>
                </tr>

                <tr>
                    <td class="center">
                        <input type="checkbox" ng-model="showInactive" ng-click="calcActive()" id="showInactive">
                    </td>
                    <Td>
                        &nbsp;<label for="showInactive" style="font-weight: normal">Inactive</label>
                    </Td>
                </tr>

                <tr>
                    <td>
                        <select class="form-control input-sm" ng-model="limit" style="width:50px;display:inline-block;padding:2px !important;font-size:11px;height:25px"
                                ng-change="resetPager()"
                                ng-options="item for item in limits">
                        </select>
                    </td>
                    <Td>
                        &nbsp;Rows
                    </Td>
                </tr>
            </table>
        </div>
    </div>

    <div class="btn-group action_dropdown stay_open_button pull-right" style="margin-right:5px">
        <button type="button" class="btn btn-default dropdown-toggle btn-sm" data-toggle="dropdown" aria-expanded="false" uib-tooltip="Show/Hide Columns">
            <span class="fa fa-table"></span> <span class="caret"></span>
        </button>
        <ul class="dropdown-menu dropdown-menu-right" role="menu" style="padding-left:10px" onclick="event.stopPropagation();">
            <li><div class="checkbox"><label><input type="checkbox" ng-model="show.rownumber" ng-checked="show.rownumber" ng-click="columnsChanged=true"> Row Number</label></div></li>
            <li><div class="checkbox"><label><input type="checkbox" ng-model="show.date" ng-checked="show.date" ng-click="columnsChanged=true"> Date</label></div></li>
            <li><div class="checkbox"><label><input type="checkbox" ng-model="show.name" ng-checked="show.name" ng-click="columnsChanged=true"> Name</label></div></li>
            <li><div class="checkbox"><label><input type="checkbox" ng-model="show.email" ng-checked="show.email" ng-click="columnsChanged=true"> Email</label></div></li>
            <li><div class="checkbox"><label><input type="checkbox" ng-model="show.role" ng-checked="show.role" ng-click="columnsChanged=true"> Role</label></div></li>
            <li><div class="checkbox"><label><input type="checkbox" ng-model="show.company" ng-checked="show.company" ng-click="columnsChanged=true"> Company</label></div></li>
            <li><div class="checkbox"><label><input type="checkbox" ng-model="show.active" ng-checked="show.active" ng-click="columnsChanged=true"> Active</label></div></li>
            <li><div class="checkbox"><label><input type="checkbox" ng-model="show.tools" ng-checked="show.tools" ng-click="columnsChanged=true"> Actions</label></div></li>
        </ul>
    </div>

    <div class="form-group has-feedback pull-right grid-search" style="margin-right:5px">
        <input type="text" class="form-control input-sm"
               placeholder="Search Users"
               ng-model="searchText"
               ng-change="resetPager()">
        <i class="fa fa-search form-control-feedback" style="color:#ccc"></i>
    </div>

    <br clear="all">


    <div class="maingrid wrapper">
        <div class="header"></div>
        <table class="table table-condensed table-striped table-hover">
            <tbody>
            <tr class="thead">
                <th ng-show="show.rownumber">#</th>
                <th ng-show="show.date" class="sortable" ng-click="toggleSort('date')">
                    <div class="pull-left">Date</div>
                    <div class="pull-right" ng-show="sort.date == null"><i class="fa fa-sort"></i></div>
                    <div class="pull-right" ng-show="sort.date === true"><i class="fa fa-sort-down"></i></div>
                    <div class="pull-right" ng-show="sort.date === false"><i class="fa fa-sort-up"></i></div>
                </th>
                <th ng-show="show.name" class="sortable" ng-click="toggleSort('name')">
                    <div class="pull-left">Name</div>
                    <div class="pull-right" ng-show="sort.name == null"><i class="fa fa-sort"></i></div>
                    <div class="pull-right" ng-show="sort.name === true"><i class="fa fa-sort-down"></i></div>
                    <div class="pull-right" ng-show="sort.name === false"><i class="fa fa-sort-up"></i></div>
                </th>
                <th ng-show="show.email" class="sortable" ng-click="toggleSort('email')">
                    <div class="pull-left">Email</div>
                    <div class="pull-right" ng-show="sort.email == null"><i class="fa fa-sort"></i></div>
                    <div class="pull-right" ng-show="sort.email === true"><i class="fa fa-sort-down"></i></div>
                    <div class="pull-right" ng-show="sort.email === false"><i class="fa fa-sort-up"></i></div>
                </th>
                <th ng-show="show.role" class="sortable" ng-click="toggleSort('role')">
                    <div class="pull-left">Role</div>
                    <div class="pull-right" ng-show="sort.role == null"><i class="fa fa-sort"></i></div>
                    <div class="pull-right" ng-show="sort.role === true"><i class="fa fa-sort-down"></i></div>
                    <div class="pull-right" ng-show="sort.role === false"><i class="fa fa-sort-up"></i></div>
                </th>
                <th ng-show="show.company" class="sortable" ng-click="toggleSort('company')" style="min-width:92px">
                    <div class="pull-left">Company</div>
                    <div class="pull-right" ng-show="sort.company == null"><i class="fa fa-sort"></i></div>
                    <div class="pull-right" ng-show="sort.company === true"><i class="fa fa-sort-down"></i></div>
                    <div class="pull-right" ng-show="sort.company === false"><i class="fa fa-sort-up"></i></div>
                </th>
                <th ng-show="show.active" class="center">
                    Active
                </th>
                <th ng-show="show.tools"></th>
            </tr>

            <tr ng-repeat="row in filtered = (data  | orderBy : orderBy | filter: search | filter : searchFilter) | skip : pageStart() - 1 | limitTo : limit">
                <td ng-show="show.rownumber">{{pageStart() + $index}}.</td>
                <td ng-show="show.date">{{row.date | date: 'shortDate'}}</td>
                <td ng-show="show.name">{{row.name}}</td>
                <td ng-show="show.email">{{row.email}}
                    <i class="fa fa-exclamation-triangle warning" class="pull-left"
                       style="color:orange;cursor:pointer;font-size:16px;padding:4px 0px 0px 5px"
                       ng-if="row.bounceReason"
                       popover-trigger="'mouseenter'"
                       popover-placement="top"
                       uib-popover="Undeliverable: {{row.bounceReason}}"
                    ></i>
                </td>
                <td ng-show="show.role">{{row.role}}</td>
                <td ng-show="show.company">{{row.company}}</td>
                <td ng-show="show.active" class="center">
                    <span class="fa fa-check fa-2x" ng-show="row.active"></span>
                    <span class="fa fa-times fa-2x" ng-show="!row.active" style="color:#ccc"></span>
                </td>
                <td ng-show="show.tools" class="center">
                    <div class="form-group has-feedback pull-right" style="margin-bottom:0px; margin-right:5px" ng-show="row._id != me._id">
                        <div class="btn-group action_dropdown">
                            <button type="button" class="btn btn-default dropdown-toggle btn-sm" data-toggle="dropdown" aria-expanded="false" style="padding:2px 5px 0px 5px">
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-right skinny" role="menu">
                                <li><a href ng-click="edit(row._id)"><span class="fa fa-edit"></span> Edit User</a></li>
                                <li><a href ng-click="toggleActive(row)" ng-show="me.permissions.indexOf('Users/Deactivate') > -1 && !row.active"><span class="fa fa-check"></span> Activate</a></li>
                                <li><a href ng-click="toggleActive(row)" ng-show="me.permissions.indexOf('Users/Deactivate') > -1 && row.active"><span class="fa fa-times"></span> De-activate</a></li>
                                <li><a href ng-click="loginAs(row._id)" ng-show="me.permissions.indexOf('Users/LogInAs') > -1 && row.active"><span class="fa fa-key"></span> Login As</a></li>
                            </ul>
                        </div>
                    </div>
                </td>
            </tr>
            </tbody>

        </table>
        <div class="pull-left grid-show" style="padding-top:5px;">
            Showing {{pageStart()}} to {{pageEnd()}} of {{filtered.length}}
            <span ng-show="filtered.length < data.length">(filtered from {{data.length}})</span>
        </div>
        <div class="pull-right grid-pager">
            <uib-pagination ng-show="filtered.length > limit" max-size="5" total-items="filtered.length" ng-model="currentPage" class="pagination-sm" items-per-page="limit"></uib-pagination>
        </div>
        <br clear="all" />
    </div>
</div>
